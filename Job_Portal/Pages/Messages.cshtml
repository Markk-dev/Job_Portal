@page
@model Job_Portal.Pages.MessagesModel
@{
    ViewData["Title"] = "Messages";
}
<head>
    <link rel="stylesheet" href="~/css/msg.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/global.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>

<div class="messages-container">
    <div class="messages-content">
        <div class="conversations-list">
            <div class="conversations-header">
                <h2 class="section-title">All messages</h2>
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="Search through your messages" />
                </div>
            </div>
            <div class="conversations">
                @foreach (var conversation in Model.Conversations)
                {
                    <a href="/Messages?conversationId=@conversation.Id" class="conversation-item @(conversation.IsSelected ? "selected" : "")">
                        <div class="conversation-avatar">
                            <div class="avatar-placeholder">
                                @conversation.RecipientName.Substring(0, 1)
                            </div>
                        </div>
                        <div class="conversation-info">
                            <div class="conversation-name">@conversation.RecipientName</div>
                            <div class="conversation-preview">@conversation.LastMessage</div>
                        </div>
                    </a>
                }
            </div>
        </div>

        <div class="message-thread">
            @if (Model.SelectedConversation != null)
            {
                <div class="thread-header">
                    <div class="thread-user">
                        <div class="conversation-avatar">
                            <div class="avatar-placeholder">
                                @Model.SelectedConversation.RecipientName.Substring(0, 1)
                            </div>
                        </div>
                        <div class="thread-user-info">
                            <div class="thread-user-name">@Model.SelectedConversation.RecipientName</div>
                            <div class="thread-user-title">@Model.SelectedConversation.RecipientTitle</div>
                        </div>
                    </div>
                </div>
                <div class="thread-messages">
                    @foreach (var message in Model.SelectedConversation.Messages)
                    {
                        <div class="message-bubble @(message.IsFromCurrentUser ? "sent" : "received")">
                            @if (!message.IsFromCurrentUser)
                            {
                                <div class="message-avatar">
                                    <div class="avatar-placeholder small">@message.SenderName.Substring(0, 1)</div>
                                </div>
                            }
                            <div class="message-content">
                                <div class="message-text">@message.Content</div>
                            </div>
                        </div>
                    }
                </div>
                <div class="message-input">
                    <form method="post" asp-page-handler="SendMessage" asp-route-conversationId="@Model.SelectedConversation.Id">
                        <input type="text" asp-for="NewMessageContent" placeholder="Type a message..." class="message-input-field" />
                        <button type="submit" class="send-button">Send</button>
                    </form>
                </div>
            }
        </div>
    </div>
</div>
